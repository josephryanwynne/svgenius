<!DOCTYPE html>
<html>
    <head>
    <style type="text/css">
        
        div, svg {
        
            border: 1px solid black;
        }
        
        
    </style>
    
    </head>
<body>
<!--

TODO
====

* Issues with stroke lines at top and bottom of the image. It should probably always start at 1px in, or use radius which is 1px less than half of the available space
* When doing the above, the overlay is no longer correctly positioned. WHY THE FUCK NOT.

-->
    
<div id="gaugeContainer" height="400" width="400"></div>
    
    
<script type="text/javascript">

document.onreadystatechange = function(){
    
    
if (document.readyState == "interactive") {
//Create the namespace to begin with
    
//SVGENIUS... the beginning of something beautiful.
var SVGENIUS = SVGENIUS || {};
SVGENIUS.charts = {
    gauge: function(){
        
        var height = 250; // Probably need to work out how much space we have dynamically. Get dimensions of containing div?
        var width = 260; // Same for this value
        
        var gaugeContainer = document.getElementById('gaugeContainer');
        var svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        svg.setAttribute('xmlns:svg',"http://www.w3.org/2000/svg");
        svg.setAttribute('xmlns', "http://www.w3.org/2000/svg");
        svg.setAttribute('height', height);
        svg.setAttribute('width', width);
        
        
        var gaugeWidth = 10; //Arbitrary... Maybe it could be configurable
        var radius = height / 2 - 1; // This should be based on how much space we have. Something like height / 2 ??
        var startX = radius;
        var startY = gaugeWidth;
        
        var endX = startX;
        var endY = startY + (2*radius);
        
        //Grey outline of the gauge - draw vertical line up, outer arc, up, inner arc.
        var outline = document.createElementNS("http://www.w3.org/2000/svg", "path");
        outline.setAttribute('d', 'M'+startX+','+startY+' v-' + 10 + ' A1,1 0 0 1 '+startX+' '+(2*radius)+' v-'+gaugeWidth+' A1,1 0 0 0 '+startX+','+startY+' Z');
        outline.setAttribute('fill', 'white');
        outline.setAttribute('stroke', 'grey');
        outline.setAttribute('stroke-width', '1');
                
        var halfwayPoint = (startX+radius)+','+radius;// Not sure what this 200 number should be calculated from
        //Marker at halfway point
        var halfwayMarker = document.createElementNS("http://www.w3.org/2000/svg", "path");
        halfwayMarker.setAttribute('d', 'M'+halfwayPoint+' h 10 Z');
        halfwayMarker.setAttribute('stroke', 'black');
        halfwayMarker.setAttribute('stroke-width', '1');
        
        var percentageDifference = 50; // Exactly halfway in the top section -- same as in testing
        
        var angle = Math.PI / (200 / percentageDifference);
        var outerArcYOffset = radius * Math.sin(angle);
        var outerArcXOffset = radius * Math.cos(angle);
        var innerArcYOffset = (radius - gaugeWidth) * Math.sin(angle);
        var innerArcXOffset = (radius - gaugeWidth) * Math.cos(angle);
        
        
        var overlay = document.createElementNS("http://www.w3.org/2000/svg", "path");
        overlay.setAttribute('d', 'M'+halfwayPoint+' l-'+gaugeWidth+',0 A'+radius+','+radius+' 0 0  0 '+(radius+innerArcXOffset)+','+(radius-innerArcYOffset)+'  L'+(radius+outerArcXOffset)+','+(radius-outerArcYOffset)+' A'+radius+','+radius+' 0 0 1 '+halfwayPoint);
        overlay.setAttribute('fill', 'green');
        overlay.setAttribute('stroke-width', '0');
        
        //Add the things to the page
        gaugeContainer.appendChild(svg);
        
        svg.addEventListener('SVGLoad', function(evt) {
                console.log('SVG onload called');
                
        });
        //var svg = document.getElementsByTagName('svg')[0];
        svg.appendChild(outline);
        svg.appendChild(halfwayMarker);
        svg.appendChild(overlay);
    }
}
    
    //Configuration for the chart
    SVGENIUS.charts.gauge({
        text: "50%<br/>Ahead", //Not yet used
        
        
    });
}
}

</script>
</body>
</html>
